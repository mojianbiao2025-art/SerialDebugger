<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAssembly è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .section {
            background: #252526;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 3px solid #007acc;
        }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        .info { color: #9cdcfe; }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a9e;
        }
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ” WebAssembly è¯Šæ–­å·¥å…·</h1>
    
    <div class="section">
        <h2>1. æ–‡ä»¶æ£€æŸ¥</h2>
        <button onclick="checkFiles()">æ£€æŸ¥æ–‡ä»¶</button>
        <div id="fileCheck"></div>
    </div>

    <div class="section">
        <h2>2. æµè§ˆå™¨æ”¯æŒ</h2>
        <div id="browserCheck"></div>
    </div>

    <div class="section">
        <h2>3. ç½‘ç»œçŠ¶æ€</h2>
        <div id="networkCheck"></div>
    </div>

    <div class="section">
        <h2>4. å¿«é€Ÿæ“ä½œ</h2>
        <button onclick="clearCache()">æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°</button>
        <button onclick="window.location.href='test-minimal.html'">æ‰“å¼€æµ‹è¯•é¡µé¢</button>
        <button onclick="window.location.href='index.html'">æ‰“å¼€ä¸»é¡µé¢</button>
    </div>

    <script>
        // æµè§ˆå™¨æ£€æŸ¥
        function checkBrowser() {
            const div = document.getElementById('browserCheck');
            let html = '<pre>';
            
            html += 'æµè§ˆå™¨: ' + navigator.userAgent + '\n';
            html += 'WebAssembly: ' + (typeof WebAssembly !== 'undefined' ? '<span class="success">âœ“ æ”¯æŒ</span>' : '<span class="error">âœ— ä¸æ”¯æŒ</span>') + '\n';
            html += 'Web Serial API: ' + ('serial' in navigator ? '<span class="success">âœ“ æ”¯æŒ</span>' : '<span class="error">âœ— ä¸æ”¯æŒ</span>') + '\n';
            html += 'localStorage: ' + (typeof Storage !== 'undefined' ? '<span class="success">âœ“ å¯ç”¨</span>' : '<span class="error">âœ— ä¸å¯ç”¨</span>') + '\n';
            html += 'WebGL: ' + (checkWebGL() ? '<span class="success">âœ“ æ”¯æŒ</span>' : '<span class="error">âœ— ä¸æ”¯æŒ</span>') + '\n';
            
            html += '</pre>';
            div.innerHTML = html;
        }

        function checkWebGL() {
            try {
                const canvas = document.createElement('canvas');
                return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
            } catch(e) {
                return false;
            }
        }

        // æ–‡ä»¶æ£€æŸ¥
        async function checkFiles() {
            const div = document.getElementById('fileCheck');
            div.innerHTML = '<pre>æ­£åœ¨æ£€æŸ¥æ–‡ä»¶...</pre>';
            
            const files = [
                'SerialDebugger.js',
                'SerialDebugger.wasm',
                'index.html',
                'test-minimal.html'
            ];
            
            let html = '<pre>';
            
            for (const file of files) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    const size = response.headers.get('content-length');
                    const sizeStr = size ? formatBytes(parseInt(size)) : 'æœªçŸ¥';
                    const status = response.ok ? '<span class="success">âœ“</span>' : '<span class="error">âœ—</span>';
                    const lastModified = response.headers.get('last-modified') || 'æœªçŸ¥';
                    
                    html += `${status} ${file}\n`;
                    html += `   å¤§å°: ${sizeStr}\n`;
                    html += `   çŠ¶æ€: ${response.status}\n`;
                    html += `   ä¿®æ”¹æ—¶é—´: ${lastModified}\n\n`;
                } catch (error) {
                    html += `<span class="error">âœ— ${file}</span>\n`;
                    html += `   é”™è¯¯: ${error.message}\n\n`;
                }
            }
            
            html += '</pre>';
            div.innerHTML = html;
        }

        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        // ç½‘ç»œæ£€æŸ¥
        function checkNetwork() {
            const div = document.getElementById('networkCheck');
            let html = '<pre>';
            
            html += 'åœ¨çº¿çŠ¶æ€: ' + (navigator.onLine ? '<span class="success">âœ“ åœ¨çº¿</span>' : '<span class="error">âœ— ç¦»çº¿</span>') + '\n';
            html += 'åè®®: ' + window.location.protocol + '\n';
            html += 'ä¸»æœº: ' + window.location.host + '\n';
            html += 'è·¯å¾„: ' + window.location.pathname + '\n';
            
            html += '</pre>';
            div.innerHTML = html;
        }

        // æ¸…é™¤ç¼“å­˜
        function clearCache() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°é¡µé¢å—ï¼Ÿ')) {
                // æ¸…é™¤ localStorage
                try {
                    localStorage.clear();
                } catch(e) {}
                
                // æ¸…é™¤ sessionStorage
                try {
                    sessionStorage.clear();
                } catch(e) {}
                
                // å¼ºåˆ¶åˆ·æ–°
                window.location.reload(true);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            checkBrowser();
            checkNetwork();
            checkFiles();
        };
    </script>
</body>
</html>
