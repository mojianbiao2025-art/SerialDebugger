# WebAssembly åŠ è½½é—®é¢˜è§£å†³æ–¹æ¡ˆ

## é—®é¢˜ç°è±¡
æµè§ˆå™¨ï¼ˆChrome 144, Edge 144ï¼‰ä¸­æ‰“å¼€é¡µé¢åï¼Œåªæ˜¾ç¤ºåŠ è½½ç•Œé¢ï¼ŒQtåº”ç”¨ç¨‹åºç•Œé¢æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ã€‚

## å·²å®æ–½çš„ä¿®å¤

### 1. å¢å¼ºçš„ index.html è°ƒè¯•åŠŸèƒ½ âœ…
å·²æ›´æ–° `index.html`ï¼Œæ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹è®¿é—®åè®®ï¼ˆfile:// vs http:// vs https://ï¼‰
- âœ… æ£€æŸ¥ Web Serial API æ”¯æŒ
- âœ… åœ¨åŠ è½½å‰éªŒè¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- âœ… æ˜¾ç¤ºæ–‡ä»¶å¤§å°å’ŒåŠ è½½è¿›åº¦
- âœ… è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’ŒçŠ¶æ€æŠ¥å‘Š
- âœ… Promise é”™è¯¯æ•è·
- âœ… WebAssembly è¿è¡Œæ—¶åˆå§‹åŒ–ç¡®è®¤

### 2. è¯Šæ–­å·¥å…·é¡µé¢ âœ…
åˆ›å»ºäº† `test-wasm-loading.html` è¯Šæ–­å·¥å…·ï¼š
- âœ… ç¯å¢ƒæ£€æŸ¥ï¼ˆåè®®ã€ä¸»æœºã€ç«¯å£ï¼‰
- âœ… æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥ï¼ˆæ‰€æœ‰å¿…éœ€æ–‡ä»¶ï¼‰
- âœ… æµè§ˆå™¨èƒ½åŠ›æ£€æŸ¥ï¼ˆWeb Serial APIã€WebAssemblyã€WebGLï¼‰
- âœ… è‡ªåŠ¨ç”Ÿæˆä¿®å¤å»ºè®®
- âœ… è¯¦ç»†æ—¥å¿—è®°å½•å’Œå¯¼å‡ºåŠŸèƒ½

### 3. å·¥ä½œæµæ”¹è¿› âœ…
æ›´æ–°äº† `.github/workflows/build-all.yml`ï¼š
- âœ… éƒ¨ç½²æ—¶åŒ…å«è¯Šæ–­å·¥å…·
- âœ… éªŒè¯å…³é”®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- âœ… æ˜¾ç¤ºæ–‡ä»¶å¤§å°ä¿¡æ¯

## è¯Šæ–­æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨è¯Šæ–­å·¥å…·
1. è®¿é—®è¯Šæ–­é¡µé¢ï¼š
   ```
   https://mojianbiao2025-art.github.io/SerialDebugger/test-wasm-loading.html
   ```
   æˆ–æœ¬åœ°ï¼š
   ```
   http://localhost:8000/test-wasm-loading.html
   ```

2. æŸ¥çœ‹è¯Šæ–­ç»“æœï¼š
   - ğŸŸ¢ ç»¿è‰² = æ­£å¸¸
   - ğŸŸ¡ é»„è‰² = è­¦å‘Š
   - ğŸ”´ çº¢è‰² = é”™è¯¯

3. æŒ‰ç…§é¡µé¢ä¸Šçš„å»ºè®®æ“ä½œ

### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼š`F12` æˆ– `Ctrl+Shift+I`
2. åˆ‡æ¢åˆ° `Console` æ ‡ç­¾
3. æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯ï¼ˆçº¢è‰²æ–‡æœ¬ï¼‰

#### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

**é”™è¯¯ Aï¼š404 Not Found**
```
GET https://xxx/SerialDebugger.js 404 (Not Found)
```
**åŸå› ï¼š** æ–‡ä»¶æœªéƒ¨ç½²æˆ–è·¯å¾„é”™è¯¯
**è§£å†³ï¼š**
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la deploy/SerialDebugger.*

# å¦‚æœä¸å­˜åœ¨ï¼Œé‡æ–°æ„å»º
cd build-wasm
ninja
cp bin/SerialDebugger.* ../deploy/
```

**é”™è¯¯ Bï¼šCORS Policy**
```
Access to script at 'file:///.../SerialDebugger.js' has been blocked by CORS policy
```
**åŸå› ï¼š** ä½¿ç”¨ file:// åè®®è®¿é—®
**è§£å†³ï¼š** å¿…é¡»ä½¿ç”¨ HTTP æœåŠ¡å™¨
```bash
cd deploy
python -m http.server 8000
# ç„¶åè®¿é—® http://localhost:8000/index.html
```

**é”™è¯¯ Cï¼šWebAssembly ç¼–è¯‘å¤±è´¥**
```
CompileError: WebAssembly.instantiate(): Compiling function failed
```
**åŸå› ï¼š** WASM æ–‡ä»¶æŸåæˆ–ä¸å®Œæ•´
**è§£å†³ï¼š** æ¸…ç†å¹¶é‡æ–°æ„å»º
```bash
rm -rf build-wasm
./rebuild_wasm_clean.sh
```

**é”™è¯¯ Dï¼šå†…å­˜ä¸è¶³**
```
RangeError: WebAssembly.Memory(): could not allocate memory
```
**åŸå› ï¼š** æµè§ˆå™¨å†…å­˜é™åˆ¶
**è§£å†³ï¼š**
- å…³é—­å…¶ä»–æ ‡ç­¾é¡µ
- é‡å¯æµè§ˆå™¨
- å¢åŠ ç³»ç»Ÿå¯ç”¨å†…å­˜

### ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥ Network æ ‡ç­¾
1. å¼€å‘è€…å·¥å…·ä¸­åˆ‡æ¢åˆ° `Network` æ ‡ç­¾
2. åˆ·æ–°é¡µé¢ï¼ˆ`F5` æˆ– `Ctrl+R`ï¼‰
3. æŸ¥çœ‹æ–‡ä»¶åŠ è½½çŠ¶æ€

#### æ­£å¸¸çš„åŠ è½½çŠ¶æ€
```
Name                    Status  Type        Size      Time
index.html              200     document    15.2 KB   50ms
SerialDebugger.js       200     script      450 KB    200ms
SerialDebugger.wasm     200     wasm        3.5 MB    800ms
lang_zh.ini             200     text        2.1 KB    20ms
styles.qss              200     text        1.5 KB    15ms
```

#### å¼‚å¸¸çŠ¶æ€
- âŒ Status 404 = æ–‡ä»¶ä¸å­˜åœ¨
- âŒ Status 403 = æƒé™è¢«æ‹’ç»
- âŒ Status 0 = CORS é”™è¯¯æˆ–ç½‘ç»œé—®é¢˜
- âŒ (failed) = åŠ è½½å¤±è´¥

## æœ¬åœ°æµ‹è¯•å®Œæ•´æµç¨‹

### æ–¹æ³• 1ï¼šä½¿ç”¨ Python HTTP æœåŠ¡å™¨ï¼ˆæ¨èï¼‰
```bash
# 1. è¿›å…¥éƒ¨ç½²ç›®å½•
cd deploy

# 2. å¯åŠ¨æœåŠ¡å™¨
python -m http.server 8000

# 3. æ‰“å¼€æµè§ˆå™¨è®¿é—®
# http://localhost:8000/test-wasm-loading.html  (å…ˆæµ‹è¯•)
# http://localhost:8000/index.html              (ä¸»åº”ç”¨)
```

### æ–¹æ³• 2ï¼šä½¿ç”¨ Node.js http-server
```bash
# 1. å®‰è£…ï¼ˆä»…éœ€ä¸€æ¬¡ï¼‰
npm install -g http-server

# 2. å¯åŠ¨æœåŠ¡å™¨
cd deploy
http-server -p 8000

# 3. è®¿é—®
# http://localhost:8000/
```

### æ–¹æ³• 3ï¼šä½¿ç”¨ PHP å†…ç½®æœåŠ¡å™¨
```bash
cd deploy
php -S localhost:8000
```

## GitHub Pages éƒ¨ç½²æ£€æŸ¥

### æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
1. è®¿é—®ä»“åº“çš„ Actions é¡µé¢ï¼š
   ```
   https://github.com/mojianbiao2025-art/SerialDebugger/actions
   ```

2. æŸ¥çœ‹æœ€æ–°çš„å·¥ä½œæµè¿è¡Œï¼š
   - âœ… ç»¿è‰²å‹¾å· = æˆåŠŸ
   - âŒ çº¢è‰²å‰å· = å¤±è´¥
   - ğŸŸ¡ é»„è‰²åœ†åœˆ = è¿›è¡Œä¸­

3. ç‚¹å‡»å·¥ä½œæµæŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### æ£€æŸ¥ GitHub Pages è®¾ç½®
1. è®¿é—®ä»“åº“è®¾ç½®ï¼š
   ```
   https://github.com/mojianbiao2025-art/SerialDebugger/settings/pages
   ```

2. ç¡®è®¤é…ç½®ï¼š
   - **Source:** Deploy from a branch
   - **Branch:** gh-pages / (root)
   - **Custom domain:** (ç•™ç©ºæˆ–è®¾ç½®è‡ªå®šä¹‰åŸŸå)

3. æŸ¥çœ‹éƒ¨ç½² URLï¼š
   ```
   https://mojianbiao2025-art.github.io/SerialDebugger/
   ```

### å¼ºåˆ¶é‡æ–°éƒ¨ç½²
å¦‚æœ GitHub Pages æ²¡æœ‰æ›´æ–°ï¼š
```bash
# 1. è§¦å‘æ–°çš„æ„å»º
git commit --allow-empty -m "Trigger rebuild"
git push

# 2. æˆ–æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ
# è®¿é—® Actions â†’ Build Android and WebAssembly â†’ Run workflow
```

## æµè§ˆå™¨è¦æ±‚

### æ”¯æŒçš„æµè§ˆå™¨ âœ…
| æµè§ˆå™¨ | æœ€ä½ç‰ˆæœ¬ | Web Serial API | WebAssembly | æ¨è |
|--------|---------|----------------|-------------|------|
| Chrome | 89+ | âœ… | âœ… | â­â­â­â­â­ |
| Edge | 89+ | âœ… | âœ… | â­â­â­â­â­ |
| Opera | 75+ | âœ… | âœ… | â­â­â­â­ |

### ä¸æ”¯æŒçš„æµè§ˆå™¨ âŒ
| æµè§ˆå™¨ | åŸå›  |
|--------|------|
| Firefox | ä¸æ”¯æŒ Web Serial API |
| Safari | ä¸æ”¯æŒ Web Serial API |
| IE | ä¸æ”¯æŒ WebAssembly |

### æ‚¨çš„æµè§ˆå™¨ï¼ˆChrome 144, Edge 144ï¼‰
âœ… **å®Œå…¨æ”¯æŒï¼** æ‚¨çš„æµè§ˆå™¨ç‰ˆæœ¬è¶³å¤Ÿæ–°ï¼Œåº”è¯¥å¯ä»¥æ­£å¸¸è¿è¡Œã€‚

## å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šé¡µé¢ä¸€ç›´æ˜¾ç¤º"æ­£åœ¨åŠ è½½..."
**å¯èƒ½åŸå› ï¼š**
- æ–‡ä»¶æœªæ­£ç¡®éƒ¨ç½²
- ä½¿ç”¨ file:// åè®®
- ç½‘ç»œè¿æ¥é—®é¢˜
- JavaScript é”™è¯¯

**è§£å†³æ­¥éª¤ï¼š**
1. æ‰“å¼€ `test-wasm-loading.html` æŸ¥çœ‹è¯Šæ–­ç»“æœ
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
3. ç¡®è®¤ä½¿ç”¨ HTTP/HTTPS åè®®è®¿é—®
4. éªŒè¯æ‰€æœ‰æ–‡ä»¶éƒ½å·²éƒ¨ç½²

### é—®é¢˜ 2ï¼šæ˜¾ç¤º"æµè§ˆå™¨ä¸æ”¯æŒ Web Serial API"
**è§£å†³ï¼š**
- ç¡®è®¤ä½¿ç”¨ Chrome 89+ã€Edge 89+ æˆ– Opera 75+
- ä¸è¦ä½¿ç”¨éšç§/æ— ç—•æ¨¡å¼
- ç¡®ä¿æµè§ˆå™¨å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

### é—®é¢˜ 3ï¼šCanvas æ˜¾ç¤ºä½†æ˜¯ç©ºç™½
**å¯èƒ½åŸå› ï¼š**
- Qt åº”ç”¨ç¨‹åºå´©æºƒ
- WebGL åˆå§‹åŒ–å¤±è´¥
- å†…å­˜ä¸è¶³

**è§£å†³ï¼š**
1. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰ WebGL é”™è¯¯
2. å°è¯•åœ¨æ§åˆ¶å°è¿è¡Œï¼š
   ```javascript
   console.log(Module);
   ```
3. é‡å¯æµè§ˆå™¨æ¸…ç†å†…å­˜

### é—®é¢˜ 4ï¼šGitHub Pages æ˜¾ç¤º 404
**æ£€æŸ¥ï¼š**
- ä»“åº“æ˜¯å¦å…¬å¼€ï¼ˆPublicï¼‰
- GitHub Pages æ˜¯å¦å·²å¯ç”¨
- ä½¿ç”¨æ­£ç¡®çš„ URL æ ¼å¼ï¼š
  ```
  https://[username].github.io/[repo]/
  ```
  ä¸æ˜¯ï¼š
  ```
  https://github.com/[username]/[repo]/  â† è¿™æ˜¯ä»“åº“é¡µé¢
  ```

## æˆåŠŸåŠ è½½çš„æ ‡å¿—

### æµè§ˆå™¨æ§åˆ¶å°åº”è¯¥æ˜¾ç¤ºï¼š
```
[æ—¶é—´] âœ“ ä½¿ç”¨ http: åè®®
[æ—¶é—´] âœ“ æµè§ˆå™¨æ”¯æŒ Web Serial API
[æ—¶é—´] æ­£åœ¨æ£€æŸ¥å¿…éœ€æ–‡ä»¶...
[æ—¶é—´] âœ“ SerialDebugger.js æ‰¾åˆ° (450 KB)
[æ—¶é—´] âœ“ SerialDebugger.wasm æ‰¾åˆ° (3.50 MB)
[æ—¶é—´] âœ“ æ‰€æœ‰å¿…éœ€æ–‡ä»¶æ£€æŸ¥é€šè¿‡ï¼Œå¼€å§‹åŠ è½½åº”ç”¨ç¨‹åº...
[æ—¶é—´] æ­£åœ¨ä¸‹è½½åº”ç”¨ç¨‹åº...
[æ—¶é—´] æ­£åœ¨åŠ è½½ä¾èµ–é¡¹ (0/1)
[æ—¶é—´] æ‰€æœ‰ä¾èµ–é¡¹å·²åŠ è½½
[æ—¶é—´] âœ“ WebAssembly è¿è¡Œæ—¶åˆå§‹åŒ–æˆåŠŸï¼
[æ—¶é—´] âœ“ åº”ç”¨ç¨‹åºåŠ è½½å®Œæˆï¼
```

### é¡µé¢åº”è¯¥æ˜¾ç¤ºï¼š
- Qt åº”ç”¨ç¨‹åºç•Œé¢
- èœå•æ ï¼ˆæ–‡ä»¶ã€ç¼–è¾‘ã€è§†å›¾ã€è¯­è¨€ã€å¸®åŠ©ï¼‰
- ä¸¤ä¸ªæ ‡ç­¾é¡µï¼ˆMainã€Plotterï¼‰
- ä¸²å£è®¾ç½®åŒºåŸŸ
- å‘é€/æ¥æ”¶æ–‡æœ¬æ¡†
- è¿æ¥/æ–­å¼€æŒ‰é’®

## ä¸‹ä¸€æ­¥æ“ä½œ

### å¦‚æœè¯Šæ–­å·¥å…·æ˜¾ç¤ºæ‰€æœ‰æ­£å¸¸
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼š
   - Chrome/Edge: `Ctrl+Shift+Delete` â†’ æ¸…é™¤ç¼“å­˜
2. ç¡¬åˆ·æ–°é¡µé¢ï¼š
   - `Ctrl+F5` æˆ– `Ctrl+Shift+R`
3. å°è¯•æ— ç—•æ¨¡å¼ï¼ˆæ’é™¤æ‰©å±•å¹²æ‰°ï¼‰

### å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨
è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ä»¥ä¾¿è¿›ä¸€æ­¥è¯Šæ–­ï¼š

1. **è¯Šæ–­å·¥å…·ç»“æœï¼š**
   - è®¿é—® `test-wasm-loading.html`
   - ç‚¹å‡»"ä¸‹è½½æ—¥å¿—"æŒ‰é’®
   - æä¾›ä¸‹è½½çš„æ—¥å¿—æ–‡ä»¶

2. **æµè§ˆå™¨æ§åˆ¶å°æˆªå›¾ï¼š**
   - æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
   - Console æ ‡ç­¾çš„å®Œæ•´å†…å®¹
   - Network æ ‡ç­¾çš„æ–‡ä»¶åˆ—è¡¨

3. **è®¿é—®ä¿¡æ¯ï¼š**
   - å®Œæ•´çš„ URL
   - æµè§ˆå™¨åç§°å’Œç‰ˆæœ¬
   - æ“ä½œç³»ç»Ÿ

4. **éƒ¨ç½²æ–¹å¼ï¼š**
   - æœ¬åœ° HTTP æœåŠ¡å™¨ï¼Ÿ
   - GitHub Pagesï¼Ÿ
   - å…¶ä»–ï¼Ÿ

## å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### æœ¬åœ°æµ‹è¯•
```bash
# å¯åŠ¨ HTTP æœåŠ¡å™¨
cd deploy
python -m http.server 8000

# è®¿é—®è¯Šæ–­å·¥å…·
# http://localhost:8000/test-wasm-loading.html

# è®¿é—®ä¸»åº”ç”¨
# http://localhost:8000/index.html
```

### é‡æ–°æ„å»º
```bash
# æ¸…ç†å¹¶é‡æ–°æ„å»º
rm -rf build-wasm
./rebuild_wasm_clean.sh

# æˆ–æ‰‹åŠ¨æ„å»º
source ~/emsdk/emsdk_env.sh
mkdir build-wasm && cd build-wasm
emcmake cmake .. -G Ninja
ninja
```

### éƒ¨ç½²æ–‡ä»¶
```bash
# å‡†å¤‡éƒ¨ç½²ç›®å½•
mkdir -p deploy
cp build-wasm/bin/SerialDebugger.* deploy/
cp index.html deploy/
cp test-wasm-loading.html deploy/
cp lang_*.ini deploy/
cp styles.qss deploy/

# éªŒè¯æ–‡ä»¶
ls -lh deploy/
```

---

**æ›´æ–°æ—¥æœŸï¼š** 2025-02-03  
**çŠ¶æ€ï¼š** å·²æ·»åŠ å¢å¼ºè°ƒè¯•åŠŸèƒ½å’Œè¯Šæ–­å·¥å…·  
**ä¸‹ä¸€æ­¥ï¼š** ç­‰å¾…ç”¨æˆ·ä½¿ç”¨è¯Šæ–­å·¥å…·å¹¶æä¾›åé¦ˆ
