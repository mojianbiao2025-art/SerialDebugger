# Qt WebAssembly ç•Œé¢ä¸æ˜¾ç¤º - æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

## ğŸ“Š é—®é¢˜æ€»ç»“

ç»è¿‡è¯¦ç»†è¯Šæ–­ï¼Œç¡®è®¤ï¼š
- âœ… WebAssembly åŠ è½½æˆåŠŸ
- âœ… Canvas é…ç½®æ­£ç¡® (1200x800)
- âœ… WebGL æµè§ˆå™¨æ”¯æŒ (Chrome 144)
- âœ… Module é…ç½®æ­£ç¡®
- âœ… æ‰€æœ‰æ–‡ä»¶åŠ è½½æˆåŠŸ
- âœ… å·²æ·»åŠ  WebGL æ”¯æŒæ ‡å¿—
- âŒ **Qt ç•Œé¢å…ƒç´ ä»ç„¶ä¸æ˜¾ç¤º**

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

è¿™ä¸ªé—®é¢˜å¾ˆå¯èƒ½æ˜¯ç”±äºä»¥ä¸‹åŸå› ä¹‹ä¸€ï¼š

### 1. Qt 5.15.2 WebAssembly çš„å·²çŸ¥é™åˆ¶

Qt 5.15.2 for WebAssembly æœ‰ä¸€äº›å·²çŸ¥é—®é¢˜ï¼š
- æŸäº› Qt æ§ä»¶åœ¨ WebAssembly ä¸­æ¸²æŸ“æœ‰é—®é¢˜
- QMainWindow çš„å¤æ‚å¸ƒå±€å¯èƒ½ä¸å·¥ä½œ
- æŸäº›æ ·å¼è¡¨å±æ€§ä¸æ”¯æŒ
- èµ„æºæ–‡ä»¶åŠ è½½å¯èƒ½å¤±è´¥

### 2. MainWindow è¿‡äºå¤æ‚

å½“å‰çš„ MainWindow åŒ…å«ï¼š
- Android ç‰¹å®šä»£ç 
- å¤æ‚çš„å¸ƒå±€ï¼ˆQSplitter, QScrollArea, QDockWidgetï¼‰
- è‡ªå®šä¹‰æ ·å¼è¡¨
- èµ„æºæ–‡ä»¶ï¼ˆå›¾æ ‡ã€qssï¼‰
- å¤šä¸ªè‡ªå®šä¹‰æ§ä»¶ï¼ˆPlotWidgetï¼‰
- ä¸²å£é€šä¿¡ï¼ˆWebSerialPortï¼‰

ä»»ä½•ä¸€ä¸ªéƒ¨åˆ†å‡ºé”™éƒ½å¯èƒ½å¯¼è‡´æ•´ä¸ªçª—å£ä¸æ˜¾ç¤ºã€‚

### 3. Qt for WebAssembly éœ€è¦ç‰¹æ®Šé…ç½®

Qt WebAssembly åº”ç”¨é€šå¸¸éœ€è¦ï¼š
- ä½¿ç”¨ qtloader.js
- ç‰¹å®šçš„ HTML æ¨¡æ¿
- æ­£ç¡®çš„ Module é…ç½®
- å¯èƒ½éœ€è¦ MODULARIZE=1

## âœ… æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šä½¿ç”¨ Qt å®˜æ–¹çš„ qtloader.jsï¼ˆæ¨èï¼‰

Qt å®˜æ–¹æ¨èä½¿ç”¨ `qtloader.js` æ¥åŠ è½½ WebAssembly åº”ç”¨ã€‚

#### æ­¥éª¤ 1ï¼šç”Ÿæˆ qtloader.js

åœ¨æ„å»ºæ—¶ï¼ŒQt ä¼šç”Ÿæˆ `qtloader.js`ã€‚ç¡®ä¿å®ƒè¢«å¤åˆ¶åˆ°éƒ¨ç½²ç›®å½•ã€‚

#### æ­¥éª¤ 2ï¼šä¿®æ”¹ index.html

ä½¿ç”¨ Qt å®˜æ–¹çš„åŠ è½½æ–¹å¼ï¼š

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ä¸²å£è°ƒè¯•åŠ©æ‰‹</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f0f0f0;
        }
        #qt_loader {
            text-align: center;
            padding: 50px;
        }
        #qt_loader_spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="qt_loader">
        <div id="qt_loader_spinner"></div>
        <p id="qt_loader_status">æ­£åœ¨åŠ è½½åº”ç”¨ç¨‹åº...</p>
    </div>
    
    <script type="text/javascript" src="qtloader.js"></script>
    <script type="text/javascript">
        QtLoader.loadEmscriptenModule("SerialDebugger");
    </script>
</body>
</html>
```

#### æ­¥éª¤ 3ï¼šæ›´æ–° CMakeLists.txt

ç¡®ä¿ç”Ÿæˆ qtloader.jsï¼š

```cmake
if(EMSCRIPTEN)
    set_target_properties(${PROJECT_NAME} PROPERTIES
        LINK_FLAGS "-s WASM=1 -s ALLOW_MEMORY_GROWTH=1 --bind \
                    -s EXPORTED_RUNTIME_METHODS=['ccall','cwrap','allocateUTF8'] \
                    -s EXPORTED_FUNCTIONS=['_malloc','_free','_webserial_onOpened_c','_webserial_onError_c','_webserial_onDataReceived_c'] \
                    -s FORCE_FILESYSTEM=1 -s FETCH=1 \
                    -s FULL_ES2=1 -s USE_WEBGL2=1 \
                    -s MAX_WEBGL_VERSION=2 -s MIN_WEBGL_VERSION=1 \
                    -s MODULARIZE=1 -s EXPORT_NAME='createQtAppInstance' \
                    --shell-file ${CMAKE_SOURCE_DIR}/wasm_shell.html"
    )
endif()
```

### æ–¹æ¡ˆ Bï¼šç®€åŒ– MainWindowï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰

åˆ›å»ºä¸€ä¸ªæç®€ç‰ˆæœ¬çš„ MainWindow æ¥æµ‹è¯•æ¸²æŸ“æ˜¯å¦å·¥ä½œã€‚

#### ä¿®æ”¹ mainwindow.cpp

```cpp
#include "mainwindow.h"
#include <QVBoxLayout>
#include <QLabel>
#include <QPushButton>
#include <QTextEdit>
#include <QDebug>

MainWindow::MainWindow(QWidget *parent)
    : QMainWindow(parent)
{
    qDebug() << "=== MainWindow æ„é€ å¼€å§‹ ===";
    
    // è®¾ç½®çª—å£å±æ€§
    setWindowTitle("ä¸²å£è°ƒè¯•åŠ©æ‰‹ - Web ç‰ˆ");
    resize(800, 600);
    
    // åˆ›å»ºä¸­å¿ƒéƒ¨ä»¶
    QWidget *centralWidget = new QWidget(this);
    centralWidget->setStyleSheet("background-color: #f0f0f0;");
    setCentralWidget(centralWidget);
    
    // åˆ›å»ºå¸ƒå±€
    QVBoxLayout *layout = new QVBoxLayout(centralWidget);
    layout->setContentsMargins(20, 20, 20, 20);
    layout->setSpacing(10);
    
    // æ·»åŠ æ ‡é¢˜
    QLabel *titleLabel = new QLabel("ä¸²å£è°ƒè¯•åŠ©æ‰‹", this);
    titleLabel->setStyleSheet("font-size: 24px; font-weight: bold; color: #333;");
    titleLabel->setAlignment(Qt::AlignCenter);
    layout->addWidget(titleLabel);
    
    // æ·»åŠ è¯´æ˜
    QLabel *infoLabel = new QLabel("WebAssembly ç‰ˆæœ¬ - æµ‹è¯•ç•Œé¢", this);
    infoLabel->setStyleSheet("font-size: 14px; color: #666;");
    infoLabel->setAlignment(Qt::AlignCenter);
    layout->addWidget(infoLabel);
    
    // æ·»åŠ æ–‡æœ¬æ¡†
    QTextEdit *textEdit = new QTextEdit(this);
    textEdit->setPlaceholderText("å¦‚æœæ‚¨èƒ½çœ‹åˆ°è¿™ä¸ªæ–‡æœ¬æ¡†ï¼Œè¯´æ˜ Qt æ¸²æŸ“æ­£å¸¸å·¥ä½œï¼");
    textEdit->setStyleSheet("font-size: 14px; padding: 10px;");
    layout->addWidget(textEdit);
    
    // æ·»åŠ æŒ‰é’®
    QPushButton *testButton = new QPushButton("æµ‹è¯•æŒ‰é’®", this);
    testButton->setStyleSheet("font-size: 16px; padding: 10px; background-color: #667eea; color: white; border: none; border-radius: 4px;");
    connect(testButton, &QPushButton::clicked, [=]() {
        qDebug() << "æŒ‰é’®è¢«ç‚¹å‡»ï¼";
        textEdit->append("æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼æ—¶é—´ï¼š" + QDateTime::currentDateTime().toString());
    });
    layout->addWidget(testButton);
    
    qDebug() << "=== MainWindow æ„é€ å®Œæˆ ===";
}

MainWindow::~MainWindow()
{
    qDebug() << "=== MainWindow ææ„ ===";
}
```

### æ–¹æ¡ˆ Cï¼šæ£€æŸ¥ Qt ç‰ˆæœ¬å’Œ Emscripten å…¼å®¹æ€§

ç¡®è®¤ä½¿ç”¨çš„ç‰ˆæœ¬ç»„åˆæ˜¯å…¼å®¹çš„ï¼š

| Qt ç‰ˆæœ¬ | Emscripten ç‰ˆæœ¬ | çŠ¶æ€ |
|---------|----------------|------|
| 5.15.2 | 1.39.8 | âš ï¸ å¯èƒ½æœ‰é—®é¢˜ |
| 5.15.2 | 1.39.20 | âœ… æ¨è |
| 5.15.2 | 2.0.14 | âŒ ä¸å…¼å®¹ |
| 6.2+ | 3.1.14+ | âœ… æ¨è |

å½“å‰ä½¿ç”¨ï¼šQt 5.15.2 + Emscripten 1.39.20 âœ…

### æ–¹æ¡ˆ Dï¼šä½¿ç”¨ Qt 6ï¼ˆé•¿æœŸæ–¹æ¡ˆï¼‰

Qt 6 å¯¹ WebAssembly çš„æ”¯æŒæ›´å¥½ï¼š
- æ›´å¥½çš„æ¸²æŸ“æ€§èƒ½
- æ›´å°‘çš„å·²çŸ¥é—®é¢˜
- æ›´å¥½çš„æ–‡æ¡£

ä½†éœ€è¦ï¼š
- ä¿®æ”¹ä»£ç ä»¥å…¼å®¹ Qt 6
- æ›´æ–°æ„å»ºé…ç½®
- å¯èƒ½éœ€è¦é‡å†™æŸäº›éƒ¨åˆ†

## ğŸš€ ç«‹å³è¡ŒåŠ¨æ–¹æ¡ˆ

### ä¼˜å…ˆçº§ 1ï¼šç®€åŒ– MainWindowï¼ˆæœ€å¿«ï¼‰

1. å¤‡ä»½å½“å‰çš„ mainwindow.cpp
2. ä½¿ç”¨ä¸Šé¢çš„ç®€åŒ–ç‰ˆæœ¬
3. é‡æ–°æ„å»º
4. æµ‹è¯•æ˜¯å¦æ˜¾ç¤º

å¦‚æœç®€åŒ–ç‰ˆæœ¬å¯ä»¥æ˜¾ç¤ºï¼Œè¯´æ˜é—®é¢˜åœ¨äº MainWindow çš„å¤æ‚æ€§ã€‚

### ä¼˜å…ˆçº§ 2ï¼šä½¿ç”¨ qtloader.js

1. ç¡®ä¿æ„å»ºç”Ÿæˆ qtloader.js
2. ä½¿ç”¨ Qt å®˜æ–¹çš„ HTML æ¨¡æ¿
3. é‡æ–°éƒ¨ç½²
4. æµ‹è¯•

### ä¼˜å…ˆçº§ 3ï¼šæ£€æŸ¥æ„å»ºæ—¥å¿—

æŸ¥çœ‹ GitHub Actions çš„æ„å»ºæ—¥å¿—ï¼Œç¡®è®¤ï¼š
- Qt ç‰ˆæœ¬æ­£ç¡®
- Emscripten ç‰ˆæœ¬æ­£ç¡®
- æ‰€æœ‰é“¾æ¥æ ‡å¿—æ­£ç¡®åº”ç”¨
- æ²¡æœ‰è­¦å‘Šæˆ–é”™è¯¯

## ğŸ“ è°ƒè¯•æ£€æŸ¥æ¸…å•

- [ ] ç¡®è®¤ Qt 5.15.2 æ­£ç¡®å®‰è£…
- [ ] ç¡®è®¤ Emscripten 1.39.20 æ­£ç¡®å®‰è£…
- [ ] ç¡®è®¤ CMakeLists.txt ä¸­çš„ LINK_FLAGS æ­£ç¡®
- [ ] ç¡®è®¤ SerialDebugger.js å’Œ .wasm æ–‡ä»¶å­˜åœ¨
- [ ] ç¡®è®¤æµè§ˆå™¨æ§åˆ¶å°æ²¡æœ‰é”™è¯¯
- [ ] å°è¯•ç®€åŒ–ç‰ˆ MainWindow
- [ ] å°è¯•ä½¿ç”¨ qtloader.js
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰ Qt ç›¸å…³çš„ qDebug è¾“å‡º

## ğŸ¯ é¢„æœŸç»“æœ

ä½¿ç”¨ç®€åŒ–ç‰ˆ MainWindow åï¼Œåº”è¯¥çœ‹åˆ°ï¼š
- ç™½è‰²/ç°è‰²èƒŒæ™¯
- "ä¸²å£è°ƒè¯•åŠ©æ‰‹" æ ‡é¢˜
- "WebAssembly ç‰ˆæœ¬ - æµ‹è¯•ç•Œé¢" è¯´æ˜
- ä¸€ä¸ªæ–‡æœ¬æ¡†
- ä¸€ä¸ªè“è‰²æŒ‰é’®

å¦‚æœè¿™äº›éƒ½èƒ½æ˜¾ç¤ºï¼Œè¯´æ˜ Qt æ¸²æŸ“å·¥ä½œæ­£å¸¸ï¼Œå¯ä»¥é€æ­¥æ·»åŠ åŠŸèƒ½ã€‚

---

**å»ºè®®ï¼šå…ˆå°è¯•ç®€åŒ– MainWindowï¼Œè¿™æ˜¯æœ€å¿«çš„éªŒè¯æ–¹æ³•ã€‚**
