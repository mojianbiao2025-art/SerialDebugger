<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å¿«é€Ÿè¯Šæ–­</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f5f5f5; }
        h1 { color: #333; }
        .result { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            font-size: 16px; 
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        .section { 
            background: white; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav-buttons { margin: 20px 0; }
        .nav-buttons button { background: #28a745; }
        .nav-buttons button:hover { background: #218838; }
    </style>
</head>
<body>
    <h1>ğŸ” Qt WebAssembly å¿«é€Ÿè¯Šæ–­</h1>
    
    <div class="section">
        <button onclick="checkAll()">ğŸ”„ è¿è¡Œæ‰€æœ‰æ£€æŸ¥</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
        <div id="results"></div>
    </div>
    
    <div class="section nav-buttons">
        <h3>ğŸ“„ æµ‹è¯•é¡µé¢å¯¼èˆª</h3>
        <button onclick="window.location.href='index.html'">ä¸»é¡µé¢</button>
        <button onclick="window.location.href='index-simple.html'">ç®€åŒ–ä¸»é¡µé¢</button>
        <button onclick="window.location.href='test-minimal.html'">æœ€å°æµ‹è¯•</button>
        <button onclick="window.location.href='test-load.html'">åŠ è½½æµ‹è¯•</button>
        <button onclick="window.location.href='diagnose.html'">å®Œæ•´è¯Šæ–­</button>
    </div>
    
    <script>
        function addResult(message, type) {
            var div = document.createElement('div');
            div.className = 'result ' + type;
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        async function checkAll() {
            clearResults();
            addResult('ğŸš€ å¼€å§‹è¯Šæ–­...', 'info');
            
            // 1. æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
            addResult('<h3>1ï¸âƒ£ æµè§ˆå™¨æ”¯æŒæ£€æŸ¥</h3>', 'info');
            
            if (typeof WebAssembly !== 'undefined') {
                addResult('âœ… WebAssembly æ”¯æŒ', 'success');
            } else {
                addResult('âŒ WebAssembly ä¸æ”¯æŒ', 'error');
                return;
            }
            
            if ('serial' in navigator) {
                addResult('âœ… Web Serial API æ”¯æŒ', 'success');
            } else {
                addResult('âš ï¸ Web Serial API ä¸æ”¯æŒï¼ˆéœ€è¦ Chrome 89+ï¼‰', 'warning');
            }
            
            // æ£€æŸ¥ WebGL
            var canvas = document.createElement('canvas');
            var gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (gl) {
                var version = gl.getParameter(gl.VERSION);
                var renderer = gl.getParameter(gl.RENDERER);
                addResult('âœ… WebGL å¯ç”¨: ' + version, 'success');
                addResult('   æ¸²æŸ“å™¨: ' + renderer, 'info');
            } else {
                addResult('âŒ WebGL ä¸å¯ç”¨', 'error');
            }
            
            // 2. æ£€æŸ¥å…³é”®æ–‡ä»¶
            addResult('<h3>2ï¸âƒ£ æ–‡ä»¶æ£€æŸ¥</h3>', 'info');
            
            var files = [
                { name: 'SerialDebugger.wasm', critical: true, minSize: 4000000 },
                { name: 'SerialDebugger.js', critical: true, minSize: 50000 },
                { name: 'index.html', critical: false },
                { name: 'index-simple.html', critical: false },
                { name: 'test-minimal.html', critical: false }
            ];
            
            for (const file of files) {
                try {
                    const response = await fetch(file.name, { method: 'HEAD' });
                    if (response.ok) {
                        const size = parseInt(response.headers.get('content-length') || '0');
                        const sizeStr = size > 1024*1024 ? 
                            (size/1024/1024).toFixed(2) + ' MB' : 
                            (size/1024).toFixed(2) + ' KB';
                        
                        if (file.minSize && size < file.minSize) {
                            addResult('âš ï¸ ' + file.name + ' å­˜åœ¨ä½†å¤ªå° (' + sizeStr + ')', 'warning');
                            addResult('   é¢„æœŸè‡³å°‘ ' + (file.minSize/1024/1024).toFixed(2) + ' MB', 'warning');
                        } else {
                            addResult('âœ… ' + file.name + ' å­˜åœ¨ (' + sizeStr + ')', 'success');
                        }
                    } else {
                        const msg = 'âŒ ' + file.name + ' ä¸å­˜åœ¨ (HTTP ' + response.status + ')';
                        addResult(msg, file.critical ? 'error' : 'warning');
                    }
                } catch (error) {
                    const msg = 'âŒ ' + file.name + ' åŠ è½½å¤±è´¥: ' + error.message;
                    addResult(msg, file.critical ? 'error' : 'warning');
                }
            }
            
            // 3. ç½‘ç»œçŠ¶æ€
            addResult('<h3>3ï¸âƒ£ ç½‘ç»œçŠ¶æ€</h3>', 'info');
            addResult('åœ¨çº¿çŠ¶æ€: ' + (navigator.onLine ? 'âœ… åœ¨çº¿' : 'âŒ ç¦»çº¿'), 
                navigator.onLine ? 'success' : 'error');
            addResult('åè®®: ' + window.location.protocol, 'info');
            addResult('ä¸»æœº: ' + window.location.host, 'info');
            
            // 4. å»ºè®®
            addResult('<h3>4ï¸âƒ£ è¯Šæ–­ç»“æœ</h3>', 'info');
            
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å…³é”®æ–‡ä»¶éƒ½æ­£å¸¸
            const wasmResponse = await fetch('SerialDebugger.wasm', { method: 'HEAD' });
            const wasmSize = parseInt(wasmResponse.headers.get('content-length') || '0');
            
            if (wasmSize > 4000000) {
                addResult('âœ… æ‰€æœ‰å…³é”®æ–‡ä»¶æ­£å¸¸ï¼', 'success');
                addResult('ğŸ“ å»ºè®®ï¼šè®¿é—® <a href="test-minimal.html">test-minimal.html</a> æµ‹è¯•åº”ç”¨åŠ è½½', 'info');
                addResult('ğŸ“ å¦‚æœåº”ç”¨å¡ä½ï¼Œæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ "Module.ccall æœªå®šä¹‰" é”™è¯¯', 'info');
            } else {
                addResult('âŒ .wasm æ–‡ä»¶å¤ªå°ï¼Œæ„å»ºå¯èƒ½å¤±è´¥', 'error');
                addResult('ğŸ“ å»ºè®®ï¼šæ£€æŸ¥ GitHub Actions æ„å»ºæ—¥å¿—', 'error');
            }
        }
        
        // è‡ªåŠ¨è¿è¡Œ
        setTimeout(checkAll, 500);
    </script>
</body>
</html>
